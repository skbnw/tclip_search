# インデックス作成手順

## 🚀 インデックスファイルの作成

検索速度を大幅に改善するため、メタデータのみのインデックスファイルを作成します。

### ステップ1: インデックスファイルを作成

PowerShellで以下を実行してください：

```powershell
# 仮想環境をアクティベート
.\venv\Scripts\Activate.ps1

# AWS認証情報を設定
$env:AWS_ACCESS_KEY_ID="YOUR_AWS_ACCESS_KEY_ID"
$env:AWS_SECRET_ACCESS_KEY="YOUR_AWS_SECRET_ACCESS_KEY"
$env:AWS_DEFAULT_REGION="ap-northeast-1"

# インデックスファイルを作成
python code\01-s3-upload\create_search_index.py
```

### ステップ2: 実行結果の確認

実行が完了すると、以下のようなメッセージが表示されます：

```
================================================================================
[SUCCESS] インデックスファイルの作成が完了しました
  ファイル: s3://tclip-raw-data-2025/rag/search_index/master_index.jsonl
  インデックス件数: 1223 件
  ファイルサイズ: X.XX MB
================================================================================
```

### ステップ3: アプリの動作確認

インデックスファイルが作成されると、次回のアプリ起動時から自動的にインデックスを使用します。

**期待される改善**:
- 初回データ読み込み: **30-60秒 → 2-5秒**
- 検索処理: **5-15秒 → 1-3秒**

---

## 📝 インデックスファイルの内容

インデックスファイルには以下が含まれます：

- `doc_id`: 番組ID
- `metadata`: メタデータ（日付、時間、放送局、番組名など）
- `full_text_preview`: 全文テキストの最初の100文字（キーワード検索用）
- `full_text_length`: 全文テキストの長さ

**注意**: 全文テキスト全体は含まれません（ファイルサイズを削減）

---

## 🔄 インデックスの更新

新しいデータが追加された場合は、再度インデックスを作成してください：

```powershell
python code\01-s3-upload\create_search_index.py
```

既存のインデックスファイルは上書きされます。

---

## ⚠️ トラブルシューティング

### エラー: "インデックスファイルが見つかりません"

- インデックスファイルがまだ作成されていない場合、アプリは従来の方法でデータを読み込みます
- 上記の手順でインデックスファイルを作成してください

### エラー: "Access Denied"

- AWS認証情報が正しく設定されているか確認してください
- S3バケットへの書き込み権限があるか確認してください

